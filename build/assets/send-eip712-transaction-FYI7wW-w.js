import{e as $}from"./eth_sendRawTransaction-DPdnXbFR.js";import{a9 as v,aX as F,I,b3 as C,b4 as L,b5 as E,b6 as k,b7 as O,b8 as W,b9 as _,ba as V,bb as g,aC as w,aD as N,aj as R,ai as K,$ as X,ab as d,aa as G,S as Z,ap as l,ao as j}from"./index-r-K8bCt4.js";import{concatHex as q}from"./concat-hex-C8eryf6L.js";import{d as J,b as Q}from"./to-serializable-transaction-BMbNRj8d.js";function Y(e,t="hex"){const n=U(e),a=J(new Uint8Array(n.length));return n.encode(a),t==="hex"?v(a.bytes):a.bytes}function U(e){return Array.isArray(e)?tt(e.map(t=>U(t))):et(e)}function tt(e){const t=e.reduce((s,r)=>s+r.length,0),n=D(t);return{length:t<=55?1+t:1+n+t,encode(s){t<=55?s.pushByte(192+t):(s.pushByte(247+n),n===1?s.pushUint8(t):n===2?s.pushUint16(t):n===3?s.pushUint24(t):s.pushUint32(t));for(const{encode:r}of e)r(s)}}}function et(e){const t=typeof e=="string"?F(e):e,n=D(t.length);return{length:t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+n+t.length,encode(s){t.length===1&&t[0]<128?s.pushBytes(t):t.length<=55?(s.pushByte(128+t.length),s.pushBytes(t)):(s.pushByte(183+n),n===1?s.pushUint8(t.length):n===2?s.pushUint16(t.length):n===3?s.pushUint24(t.length):s.pushUint32(t.length),s.pushBytes(t))}}}function D(e){if(e<2**8)return 1;if(e<2**16)return 2;if(e<2**24)return 3;if(e<2**32)return 4;throw new I("Length is too large.")}const nt=2n**16n-1n;function st(e,t,n,a){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,a);const s=BigInt(32),r=BigInt(4294967295),i=Number(n>>s&r),o=Number(n&r),h=a?4:0,f=a?0:4;e.setUint32(t+h,i,a),e.setUint32(t+f,o,a)}function at(e,t,n){return e&t^~e&n}function it(e,t,n){return e&t^e&n^t&n}class rt extends C{constructor(t,n,a,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=a,this.isLE=s,this.buffer=new Uint8Array(t),this.view=L(this.buffer)}update(t){E(this),t=k(t),O(t);const{view:n,buffer:a,blockLen:s}=this,r=t.length;for(let i=0;i<r;){const o=Math.min(s-this.pos,r-i);if(o===s){const h=L(t);for(;s<=r-i;i+=s)this.process(h,i);continue}a.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){E(this),W(t,this),this.finished=!0;const{buffer:n,view:a,blockLen:s,isLE:r}=this;let{pos:i}=this;n[i++]=128,_(this.buffer.subarray(i)),this.padOffset>s-i&&(this.process(a,0),i=0);for(let c=i;c<s;c++)n[c]=0;st(a,s-8,BigInt(this.length*8),r),this.process(a,0);const o=L(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=h/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<f;c++)o.setUint32(4*c,u[c],r)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const a=t.slice(0,n);return this.destroy(),a}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:a,length:s,finished:r,destroyed:i,pos:o}=this;return t.destroyed=i,t.finished=r,t.length=s,t.pos=o,s%n&&t.buffer.set(a),t}clone(){return this._cloneInto()}}const y=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ot=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),b=new Uint32Array(64);class ct extends rt{constructor(t=32){super(64,t,8,!1),this.A=y[0]|0,this.B=y[1]|0,this.C=y[2]|0,this.D=y[3]|0,this.E=y[4]|0,this.F=y[5]|0,this.G=y[6]|0,this.H=y[7]|0}get(){const{A:t,B:n,C:a,D:s,E:r,F:i,G:o,H:h}=this;return[t,n,a,s,r,i,o,h]}set(t,n,a,s,r,i,o,h){this.A=t|0,this.B=n|0,this.C=a|0,this.D=s|0,this.E=r|0,this.F=i|0,this.G=o|0,this.H=h|0}process(t,n){for(let c=0;c<16;c++,n+=4)b[c]=t.getUint32(n,!1);for(let c=16;c<64;c++){const p=b[c-15],x=b[c-2],B=g(p,7)^g(p,18)^p>>>3,m=g(x,17)^g(x,19)^x>>>10;b[c]=m+b[c-7]+B+b[c-16]|0}let{A:a,B:s,C:r,D:i,E:o,F:h,G:f,H:u}=this;for(let c=0;c<64;c++){const p=g(o,6)^g(o,11)^g(o,25),x=u+p+at(o,h,f)+ot[c]+b[c]|0,m=(g(a,2)^g(a,13)^g(a,22))+it(a,s,r)|0;u=f,f=h,h=o,o=i+x|0,i=r,r=s,s=a,a=x+m|0}a=a+this.A|0,s=s+this.B|0,r=r+this.C|0,i=i+this.D|0,o=o+this.E|0,h=h+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(a,s,r,i,o,h,f,u)}roundClean(){_(b)}destroy(){this.set(0,0,0,0,0,0,0,0),_(this.buffer)}}const ht=V(()=>new ct),ft=ht;function ut(e,t){const n=ft(N(e,{strict:!1})?w(e):e);return R(n)}const A=nt*32n;class dt extends I{constructor({givenLength:t,maxBytecodeSize:n}){super(`Bytecode cannot be longer than ${n} bytes. Given length: ${t}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class xt extends I{constructor({givenLengthInWords:t}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${t}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class pt extends I{constructor({givenLength:t}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${t}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function gt(e){const t=w(e);if(t.length%32!==0)throw new pt({givenLength:t.length});if(t.length>A)throw new dt({givenLength:t.length,maxBytecodeSize:A});const n=ut(t),a=w(n),s=t.length/32;if(s%2===0)throw new xt({givenLengthInWords:s});const r=w(s),i=K(r,{size:2}),o=new Uint8Array([1,0]);return a.set(o,0),a.set(i,2),a}function P(e){if(["string","number"].includes(typeof e)&&!Number.isInteger(Number(e)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${e} of type ${typeof e}`);return e instanceof Uint8Array?BigInt(X(e)):BigInt(e)}const T=(e,t)=>typeof e=="bigint"?t(e):Array.isArray(e)?e.map(n=>T(n,t)):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([n,a])=>[n,T(a,t)])):e,H=50000n,yt=e=>{const t=bt(e);return{domain:{chainId:e.chainId,name:"zkSync",version:"2"},message:t,primaryType:"Transaction",types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]}}};function bt(e){const{gas:t,nonce:n,to:a,from:s,value:r,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:h,paymasterInput:f,gasPerPubdata:u,data:c,factoryDeps:p}=e;return{data:c||"0x0",factoryDeps:p?.map(x=>d(gt(x)))??[],from:BigInt(s),gasLimit:t??0n,gasPerPubdataByteLimit:u??H,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,nonce:n?BigInt(n):0n,paymaster:h?BigInt(h):0n,paymasterInput:f||"0x",to:a?BigInt(a):0n,txType:113n,value:r??0n}}async function lt(e){const{account:t,transaction:n}=e,a=await z(e),s=await S({account:t,chainId:n.chain.id,eip712Transaction:a}),r=G(n),i=await $(r,s);return{chain:n.chain,client:n.client,transactionHash:i}}async function S(e){const{account:t,eip712Transaction:n,chainId:a}=e,s=yt(n),r=await t.signTypedData({...s});return mt({...n,chainId:a,customSignature:r})}async function z(e){const{account:t,transaction:n}=e,{gas:a,maxFeePerGas:s,maxPriorityFeePerGas:r,gasPerPubdata:i}=await M({from:Z(t.address),transaction:n});return{...await Q({from:t.address,transaction:{...n,gas:a,maxFeePerGas:s,maxPriorityFeePerGas:r}}),...n.eip712,from:t.address,gasPerPubdata:i}}function mt(e){const{chainId:t,gas:n,nonce:a,to:s,from:r,value:i,maxFeePerGas:o,maxPriorityFeePerGas:h,customSignature:f,factoryDeps:u,paymaster:c,paymasterInput:p,gasPerPubdata:x,data:B}=e,m=[a?d(a):"0x",h?d(h):"0x",o?d(o):"0x",n?d(n):"0x",s??"0x",i?d(i):"0x",B??"0x0",d(t),d(""),d(""),d(t),r??"0x",x?d(x):d(H),u??[],f??"0x",c&&p?[c,p]:[]];return q(["0x71",Y(m)])}async function M(e){const{transaction:t,from:n}=e;let[a,s,r,i]=await Promise.all([l(t.gas),l(t.maxFeePerGas),l(t.maxPriorityFeePerGas),l(t.eip712)]),o=i?.gasPerPubdata;if(a===void 0||s===void 0||r===void 0){const h=G(t),f=await Bt({from:n,transaction:t}),u=await h({method:"zks_estimateFee",params:[T(f,d)]});a=P(u.gas_limit)*2n,s=P(u.max_fee_per_gas)*2n,r=P(u.max_priority_fee_per_gas)||1n,o=P(u.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}return{gas:a,gasPerPubdata:o,maxFeePerGas:s,maxPriorityFeePerGas:r}}async function Bt(e){const{transaction:t,from:n}=e,[a,s,r,i]=await Promise.all([j(t),l(t.to),l(t.value),l(t.eip712)]),o=i?.gasPerPubdata;return{data:a,eip712Meta:{...i,factoryDeps:i?.factoryDeps?.map(h=>Array.from(F(h))),gasPerPubdata:o||50000n},from:n,gasPerPubdata:o,to:s,type:"0x71",value:r}}const _t=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:M,populateEip712Transaction:z,sendEip712Transaction:lt,signEip712Transaction:S},Symbol.toStringTag,{value:"Module"}));export{_t as a,z as p,S as s,P as t};
