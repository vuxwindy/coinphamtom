const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-CPXEllYD.js","assets/index-r-K8bCt4.js","assets/index-BwMRwPhq.css"])))=>i.map(i=>d[i]);
import{I as S,J as V,K as E,L as I,M as R,N as m,O as K,P as w,Q as Y,R as D,S as v,U as z,V as x,X as B,Y as Q,Z as X,$ as Z,a0 as M,a1 as G}from"./index-r-K8bCt4.js";const H=e=>e;class ee extends S{constructor({body:a,error:n,url:t}){super("RPC Request failed.",{cause:n,details:n.message,metaMessages:[`URL: ${H(t)}`,`Request body: ${V(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=n.code,this.data=n.data}}const ne=-1;class ae extends S{constructor(a,{code:n,docsPath:t,metaMessages:i,name:s,shortMessage:o}){super(o,{cause:a,docsPath:t,metaMessages:i||a?.metaMessages,name:s||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=s||a.name,this.code=a instanceof ee?a.code:n??ne}}class L extends ae{constructor(a,n){super(a,n),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=n.data}}class y extends L{constructor(a){super(a,{code:y.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(y,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class b extends L{constructor(a){super(a,{code:b.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(b,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const te="08c4b07e3ad25f1a27c14a4e8cecb6f0",N="eip155",_="tw:connected-wallet-params";async function ie(e,a,n){if(!se(n))throw new Error("given params are not stringifiable");const t=await e.getItem(_);let i;if(t){try{i=JSON.parse(t)}catch{i={}}i[a]=n}else i={[a]:n};e.setItem(_,E(i))}async function ce(e,a){const n=await e.getItem(_);if(!n)return null;try{const t=JSON.parse(n);return t?.[a]?t[a]:null}catch{return null}}function se(e){try{return E(e),!0}catch{return!1}}let C=null;const P={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function le(e,a,n,t,i){const s=await j(e,n,i),o=e.walletConnect;let{onDisplayUri:c}=o||{};const r=await I(n);!c&&i&&(c=A=>{const q=r.mobile.native||r.mobile.universal;if(!q){i(A);return}const J=Y(q,A).redirect;i(J)}),c&&s.events.addListener("display_uri",c);let u=o?.optionalChains,d=e.chain;n==="global.safe"&&(u=F.map(m),d&&!u.includes(d)&&(d=void 0));const{chains:l,rpcMap:p}=oe({chain:d,client:e.client,optionalChains:u});await s.connect({...o?.pairingTopic?{pairingTopic:o?.pairingTopic}:{},namespaces:{[N]:{chains:l,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:p}}}),k(l.map(g=>Number(g.split(":")[1])),t);const h=l[0]?.split(":")[1]||1,f=R(h),U=(await s.request({method:"eth_requestAccounts",params:[]},`eip155:${f}`))[0];if(!U)throw new Error("No accounts found on provider.");const W=e.chain&&e.chain.id===f?e.chain:m(f);if(e){const g={chain:e.chain,optionalChains:e.walletConnect?.optionalChains,pairingTopic:e.walletConnect?.pairingTopic};t&&ie(t,n,g)}return o?.onDisplayUri&&s.events.removeListener("display_uri",o.onDisplayUri),$(U,W,s,a,t,e.client,r,i)}async function he(e,a,n,t,i){const s=t?await ce(t,n):null,o=await I(n),c=await j(s?{chain:s.chain,client:e.client,walletConnect:{optionalChains:s.optionalChains,pairingTopic:s.pairingTopic}}:{client:e.client,walletConnect:{}},n,i);if(!c.session)throw await c.disconnect(),new Error("No wallet connect session found on provider.");const u=c.session?.namespaces?.[N]?.accounts?.[0]?.split(":")[2];if(!u)throw new Error("No accounts found on provider.");const d=e.chain?.id||1,l=R(d),p=e.chain&&e.chain.id===l?e.chain:m(l);return $(u,p,c,a,t,e.client,o,i)}async function j(e,a,n){if(C)return C;const t=await I(a),i=e.walletConnect,{UniversalProvider:s}=await K(async()=>{const{UniversalProvider:u}=await import("./index.es-CPXEllYD.js").then(d=>d.k);return{UniversalProvider:u}},__vite__mapDeps([0,1,2]));let o=i?.optionalChains,c=e.chain;a==="global.safe"&&(o=F.map(m),c&&!o.includes(c)&&(c=void 0));const r=await s.init({metadata:{description:i?.appMetadata?.description||w().description,icons:[i?.appMetadata?.logoUrl||w().logoUrl],name:i?.appMetadata?.name||w().name,url:i?.appMetadata?.url||w().url,redirect:{native:t.mobile.native||void 0,universal:t.mobile.universal||void 0}},projectId:i?.projectId||te});if(r.events.setMaxListeners(Number.POSITIVE_INFINITY),a!=="walletConnect"){async function u(){const d=r.session?.peer?.metadata?.redirect?.native||t.mobile.native||t.mobile.universal;n&&d&&await n(d)}r.on("session_request_sent",u),r.events.addListener("disconnect",()=>{r.off("session_request_sent",u),C=null})}return C=r,r}function O({provider:e,address:a,client:n,chain:t,sessionRequestHandler:i,walletInfo:s}){return{address:v(a),async sendTransaction(c){const r=await T({provider:e,payload:{method:"eth_sendTransaction",params:[{data:c.data,from:v(a),gas:c.gas?M(c.gas):void 0,to:c.to,value:c.value?M(c.value):void 0}]},chain:`eip155:${c.chainId}`,walletInfo:s,sessionRequestHandler:i});return G({chainId:c.chainId,client:n,contractAddress:c.to??void 0,gasPrice:c.gasPrice,transactionHash:r,walletAddress:v(a),walletType:"walletConnect"}),{transactionHash:r}},async signMessage({message:c}){const r=typeof c=="string"?X(c):c.raw instanceof Uint8Array?Z(c.raw):c.raw;return T({provider:e,payload:{method:"personal_sign",params:[r,this.address]},chain:`eip155:${t.id}`,walletInfo:s,sessionRequestHandler:i})},async signTypedData(c){const r=z(c),{domain:u,message:d,primaryType:l}=r,p={EIP712Domain:x({domain:u}),...r.types};B({domain:u,message:d,primaryType:l,types:p});const h=Q({domain:u??{},message:d,primaryType:l,types:p});return await T({provider:e,payload:{method:"eth_signTypedData_v4",params:[this.address,h]},chain:`eip155:${t.id}`,walletInfo:s,sessionRequestHandler:i})}}}async function T(e){const{provider:a,payload:n,chain:t,walletInfo:i,sessionRequestHandler:s}=e,o=a.request(n,t),c=a.session?.peer?.metadata?.redirect?.native||i.mobile.native||i.mobile.universal;return s&&c&&await s(c),o}function $(e,a,n,t,i,s,o,c){const r=O({address:e,chain:a,client:s,provider:n,sessionRequestHandler:c,walletInfo:o});async function u(){n.removeListener("accountsChanged",l),n.removeListener("chainChanged",p),n.removeListener("disconnect",d),await n.disconnect(),C=null}function d(){k([],i),i?.removeItem(P.lastUsedChainId),u(),t.emit("disconnect",void 0)}function l(h){if(h[0]){const f=O({address:v(h[0]),chain:a,client:s,provider:n,sessionRequestHandler:c,walletInfo:o});t.emit("accountChanged",f),t.emit("accountsChanged",h)}else d()}function p(h){const f=m(R(h));t.emit("chainChanged",f),i?.setItem(P.lastUsedChainId,String(h))}return n.on("accountsChanged",l),n.on("chainChanged",p),n.on("disconnect",d),n.on("session_delete",d),[r,a,u,h=>re(n,h)]}async function re(e,a){const n=a.id;try{e.setDefaultChain(`eip155:${n}`)}catch(t){const i=typeof t=="string"?t:t?.message;throw/user rejected request/i.test(i)?new y(t):new b(t)}}function k(e,a){a?.setItem(P.requestedChains,E(e))}function oe(e){const a={},n=[];e.chain&&(a[e.chain.id]=D({chain:e.chain,client:e.client}),n.push(e.chain.id));const t=(e?.optionalChains||[]).slice(0,10);for(const i of t)a[i.id]=D({chain:i,client:e.client}),n.push(i.id);return!e.chain&&t.length===0&&(a[1]=m(1).rpc,n.push(1)),{chains:n.map(i=>`eip155:${i}`),rpcMap:a}}const F=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{he as autoConnectWC,le as connectWC};
