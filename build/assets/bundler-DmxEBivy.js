import{a as N,e as z,i as V,p as v}from"./utils-GbVwyc3t.js";import{I as W,aD as q,aM as b,bc as Z,bd as x,b0 as H,aB as M,aC as $,aN as U,be as K,bf as L,bg as j,aZ as Q,bh as I,aE as Y,ap as J,ab as X,ac as ee,ak as te,a7 as ne,K as P,al as S,am as m,bi as re}from"./index-r-K8bCt4.js";import{f as F,h as se,i as ie,e as R,P as ae,j as oe}from"./to-serializable-transaction-BMbNRj8d.js";class ce extends W{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const w=F;function ue(t){const{abi:e,args:n=[],name:i}=t,o=q(i,{strict:!1}),a=e.filter(s=>o?s.type==="function"?se(s)===i:s.type==="event"?w(s)===i:!1:"name"in s&&s.name===i);if(a.length===0)return;if(a.length===1)return a[0];let r;for(const s of a){if(!("inputs"in s))continue;if(!n||n.length===0){if(!s.inputs||s.inputs.length===0)return s;continue}if(!s.inputs||s.inputs.length===0||s.inputs.length!==n.length)continue;if(n.every((c,f)=>{const l="inputs"in s&&s.inputs[f];return l?E(c,l):!1})){if(r&&"inputs"in r&&r.inputs){const c=C(s.inputs,r.inputs,n);if(c)throw new Z({abiItem:s,type:c[0]},{abiItem:r,type:c[1]})}r=s}}return r||a[0]}function E(t,e){const n=typeof t,i=e.type;switch(i){case"address":return b(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return i==="tuple"&&"components"in e?Object.values(e.components).every((o,a)=>E(Object.values(t)[a],o)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(i)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(i)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(i)?Array.isArray(t)&&t.every(o=>E(o,{...e,type:i.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function C(t,e,n){for(const i in t){const o=t[i],a=e[i];if(o.type==="tuple"&&a.type==="tuple"&&"components"in o&&"components"in a)return C(o.components,a.components,n[i]);const r=[o.type,a.type];if(r.includes("address")&&r.includes("bytes20")?!0:r.includes("address")&&r.includes("string")?b(n[i],{strict:!1}):r.includes("address")&&r.includes("bytes")?b(n[i],{strict:!1}):!1)return r}}const B="/docs/contract/encodeEventTopics";function de(t){const{abi:e,eventName:n,args:i}=t;let o=e[0];if(n){const u=ue({abi:e,name:n});if(!u)throw new x(n,{docsPath:B});o=u}if(o.type!=="event")throw new x(void 0,{docsPath:B});const a=H(o),r=w(a);let s=[];if(i&&"inputs"in o){const u=o.inputs?.filter(f=>"indexed"in f&&f.indexed),c=Array.isArray(i)?i:Object.values(i).length>0?u?.map(f=>i[f.name])??[]:[];c.length>0&&(s=u?.map((f,l)=>Array.isArray(c[l])?c[l].map((h,A)=>T({param:f,value:c[l][A]})):typeof c[l]<"u"&&c[l]!==null?T({param:f,value:c[l]}):null)??[])}return[r,...s]}function T({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return M($(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new ce(t.type);return ie([t],[e])}function fe(t,e){if(!b(t,{strict:!1}))throw new U({address:t});if(!b(e,{strict:!1}))throw new U({address:e});return t.toLowerCase()===e.toLowerCase()}const _="/docs/contract/decodeEventLog";function pe(t){const{abi:e,data:n,strict:i,topics:o}=t,a=i??!0,[r,...s]=o;if(!r)throw new K({docsPath:_});const u=e.find(d=>d.type==="event"&&r===w(H(d)));if(!(u&&"name"in u)||u.type!=="event")throw new L(r,{docsPath:_});const{name:c,inputs:f}=u,l=f?.some(d=>!("name"in d&&d.name)),h=l?[]:{},A=f.map((d,p)=>[d,p]).filter(([d])=>"indexed"in d&&d.indexed);for(let d=0;d<A.length;d++){const[p,G]=A[d],O=s[d];if(!O)throw new j({abiItem:u,param:p});h[l?G:p.name||G]=le({param:p,value:O})}const g=f.filter(d=>!("indexed"in d&&d.indexed));if(g.length>0){if(n&&n!=="0x")try{const d=R(g,n);if(d)if(l)for(let p=0;p<f.length;p++)h[p]=h[p]??d.shift();else for(let p=0;p<g.length;p++)h[g[p].name]=d[p]}catch(d){if(a)throw d instanceof Q||d instanceof ae?new I({abiItem:u,data:n,params:g,size:Y(n)}):d}else if(a)throw new I({abiItem:u,data:"0x",params:g,size:0})}return{eventName:c,args:Object.values(h).length>0?h:void 0}}function le({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(R([t],e)||[])[0]}function me(t){const{abi:e,args:n,logs:i,strict:o=!0}=t,a=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return i.map(r=>{try{const s=e.find(c=>c.type==="event"&&r.topics[0]===w(c));if(!s)return null;const u=pe({...r,abi:[s],strict:o});return a&&!a.includes(u.eventName)||!ye({args:u.args,inputs:s.inputs,matchArgs:n})?null:{...u,...r}}catch(s){let u,c;if(s instanceof L)return null;if(s instanceof I||s instanceof j){if(o)return null;u=s.abiItem.name,c=s.abiItem.inputs?.some(f=>!("name"in f&&f.name))}return{...r,args:c?[]:{},eventName:u}}}).filter(Boolean)}function ye(t){const{args:e,inputs:n,matchArgs:i}=t;if(!i)return!0;if(!e)return!1;function o(a,r,s){try{return a.type==="address"?fe(r,s):a.type==="string"||a.type==="bytes"?M($(r))===s:r===s}catch{return!1}}return Array.isArray(e)&&Array.isArray(i)?i.every((a,r)=>{if(a==null)return!0;const s=n[r];return s?(Array.isArray(a)?a:[a]).some(c=>o(s,c,e[r])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof i=="object"&&!Array.isArray(i)?Object.entries(i).every(([a,r])=>{if(r==null)return!0;const s=n.find(c=>c.name===a);return s?(Array.isArray(r)?r:[r]).some(c=>o(s,c,e[a])):!1}):!1}function he(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function D(t){const{signature:e}=t;let n;return he(e)?n=e:n=N(e),{abiEvent:n,hash:F(n),topics:de({abi:[n],args:t.filters})}}function ge(t){const{logs:e,events:n,strict:i}=t;return me({abi:n.map(o=>o.abiEvent),logs:e,strict:i})}function be(t,e){return e&&(t.__preparedMethod=e.preparedMethod,t.__contract=e.contract),t}function xe(t){const{contract:e,method:n,params:i,...o}=t,a=()=>(async()=>{if(Array.isArray(n))return n;if(V(n))return v(n);if(typeof n=="function")return v(await n(e));if(typeof n=="string"&&n.startsWith("function ")){const r=N(n);if(r.type==="function")return v(r);throw new Error('"method" passed is not of type "function"')}if(e.abi&&e.abi?.length>0){const r=e.abi?.find(s=>s.type==="function"&&s.name===n);if(r)return v(r)}throw new Error(`Could not resolve method "${n}".`)})();return be({...o,chain:e.chain,client:e.client,data:async()=>{let r;return Array.isArray(n)?r=n:r=await a(),r[1].length===0?r[0]:r[0]+z(r[1],await J(i??[])).slice(2)},to:e.address},{contract:e,preparedMethod:a})}function Ue(t){let e;return()=>(e||(e=t()),e)}function Ae(t={}){return D({filters:t,signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function ve(t={}){return D({filters:t,signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}function we(t){const{receipt:e}=t,n={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,status:e.status,to:e.to?e.to:null,transactionHash:e.transactionHash,transactionIndex:e.transactionIndex,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce),receipt:n,userOpHash:t.userOpHash}}const Pe=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296)),o=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|i<<BigInt(64)|o<<BigInt(32)|a};function k(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,n==null||ee(n)?n:X(n)]))}async function Be(t){return y({...t,operation:"eth_sendUserOperation",params:[k(t.userOp),t.options.entrypointAddress??S]})}async function Te(t,e){const n=await y({...t,operation:"eth_estimateUserOperationGas",params:[k(t.userOp),t.options.entrypointAddress??S,e??{}]});return{callGasLimit:m(n.callGasLimit)+re,paymasterPostOpGasLimit:n.paymasterPostOpGasLimit!==void 0?m(n.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:n.paymasterVerificationGasLimit!==void 0?m(n.paymasterVerificationGasLimit):void 0,preVerificationGas:m(n.preVerificationGas),verificationGas:n.verificationGas!==void 0?m(n.verificationGas):void 0,verificationGasLimit:m(n.verificationGasLimit)}}async function _e(t){const e=await y({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxFeePerGas:m(e.maxFeePerGas),maxPriorityFeePerGas:m(e.maxPriorityFeePerGas)}}async function Ne(t){const e=await Ie(t);if(e){if(e.success===!1){const i=ge({events:[Ae(),ve()],logs:e.logs})[0]?.args?.revertReason;if(!i)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=oe({data:i});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Ie(t){const e=await y({operation:"eth_getUserOperationReceipt",options:t,params:[t.userOpHash]});if(e)return we(e)}async function He(t){const e=await y({operation:"zk_paymasterData",options:t.options,params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function Me(t){return{transactionId:(await y({...t,operation:"tw_execute",params:[t.eoaAddress,t.wrappedCalls,t.signature,t.authorization]})).queueId}}async function $e(t){return{transactionHash:(await y({...t,operation:"tw_getTransactionHash",params:[t.transactionId]})).transactionHash}}async function Le(t){return{transactionHash:(await y({operation:"zk_broadcastTransaction",options:t.options,params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function y(t){const{options:e,operation:n,params:i}=t,o=e.bundlerUrl??te(e.chain),r=await ne(e.client)(o,{useAuthToken:!0,body:P({id:1,jsonrpc:"2.0",method:n,params:i}),headers:{"Content-Type":"application/json"},method:"POST"}),s=await r.json();if(!r.ok||s.error){let u=s.error||r.statusText;typeof u=="object"&&(u=P(u));const c=s.code||"UNKNOWN";throw new Error(`${n} error: ${u}
Status: ${r.status}
Code: ${c}`)}return s.result}export{_e as a,Pe as b,He as c,Le as d,Te as e,Be as f,Ne as g,k as h,Me as i,$e as j,Ue as o,xe as p};
